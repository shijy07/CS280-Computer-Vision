function H = affine_solve(u,v)
%u,v are 2*4 matrices
H=zeros(3,3);
H(3,3)=1;
U=zeros(3,3);
U(1,1)=norm(u(1,:))^2;
U(2,2)=norm(u(2,:))^2;
U(3,3)=4;
U(1,2)=u(1,:)*(u(2,:)');
U(2,1)=U(1,2);
U(1,3)=sum(u(1,:));
U(3,1)=U(1,3);
U(2,3)=sum(u(2,:));
U(3,2)=U(2,3);
A=[U,zeros(3,3);zeros(3,3),U];
b=zeros(6,1);
b(1)=u(1,:)*(v(1,:)');
b(2)=u(2,:)*(v(1,:)');
b(3)=sum(v(1,:));
b(4)=u(1,:)*(v(2,:)');
b(5)=u(2,:)*(v(2,:)');
b(6)=sum(v(2,:));
x=A\b;
H(1,1)=x(1);
H(1,2)=x(2);
H(1,3)=x(3);
H(2,1)=x(4);
H(2,2)=x(5);
H(2,3)=x(6);
end